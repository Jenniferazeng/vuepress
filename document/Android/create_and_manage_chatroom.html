<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>创建和管理聊天室以及监听器介绍 | 环信 IM 文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/vuepress/logo.png">
    <meta name="description" content="环信即时通讯云最新集成文档，一天内即可帮APP快速集成聊天功能。 环信客户互动云集成文档，快速多渠道集成，为企业提供智能客服系统。">
    
    <link rel="preload" href="/vuepress/assets/css/0.styles.7ff8f1d4.css" as="style"><link rel="preload" href="/vuepress/assets/js/app.b5d11d4d.js" as="script"><link rel="preload" href="/vuepress/assets/js/3.6e2d5973.js" as="script"><link rel="preload" href="/vuepress/assets/js/1.7ac2d96d.js" as="script"><link rel="preload" href="/vuepress/assets/js/15.dce43bf0.js" as="script"><link rel="prefetch" href="/vuepress/assets/js/10.e8437e28.js"><link rel="prefetch" href="/vuepress/assets/js/11.9fe3bf56.js"><link rel="prefetch" href="/vuepress/assets/js/12.f290af0a.js"><link rel="prefetch" href="/vuepress/assets/js/13.c0196c36.js"><link rel="prefetch" href="/vuepress/assets/js/14.a3dfd164.js"><link rel="prefetch" href="/vuepress/assets/js/16.0dc071f2.js"><link rel="prefetch" href="/vuepress/assets/js/17.8bac3a64.js"><link rel="prefetch" href="/vuepress/assets/js/18.464e6aa8.js"><link rel="prefetch" href="/vuepress/assets/js/19.0e0b6153.js"><link rel="prefetch" href="/vuepress/assets/js/20.949f5940.js"><link rel="prefetch" href="/vuepress/assets/js/21.594d9e12.js"><link rel="prefetch" href="/vuepress/assets/js/22.2a14e639.js"><link rel="prefetch" href="/vuepress/assets/js/23.eabc8f82.js"><link rel="prefetch" href="/vuepress/assets/js/24.aaa94294.js"><link rel="prefetch" href="/vuepress/assets/js/25.994cd948.js"><link rel="prefetch" href="/vuepress/assets/js/26.5f9068fe.js"><link rel="prefetch" href="/vuepress/assets/js/27.2abe0ec7.js"><link rel="prefetch" href="/vuepress/assets/js/28.3b0dd525.js"><link rel="prefetch" href="/vuepress/assets/js/29.eda473d8.js"><link rel="prefetch" href="/vuepress/assets/js/30.71f7ac23.js"><link rel="prefetch" href="/vuepress/assets/js/31.4b587eee.js"><link rel="prefetch" href="/vuepress/assets/js/32.cd102949.js"><link rel="prefetch" href="/vuepress/assets/js/33.825666d3.js"><link rel="prefetch" href="/vuepress/assets/js/34.eb6af016.js"><link rel="prefetch" href="/vuepress/assets/js/35.11e0522b.js"><link rel="prefetch" href="/vuepress/assets/js/36.b520a6a3.js"><link rel="prefetch" href="/vuepress/assets/js/37.e41ab147.js"><link rel="prefetch" href="/vuepress/assets/js/38.2f181e4b.js"><link rel="prefetch" href="/vuepress/assets/js/39.f0d7cb1d.js"><link rel="prefetch" href="/vuepress/assets/js/4.e2bccb64.js"><link rel="prefetch" href="/vuepress/assets/js/40.5844dd8b.js"><link rel="prefetch" href="/vuepress/assets/js/41.4747d013.js"><link rel="prefetch" href="/vuepress/assets/js/42.c089b866.js"><link rel="prefetch" href="/vuepress/assets/js/43.db036f70.js"><link rel="prefetch" href="/vuepress/assets/js/44.455d63e5.js"><link rel="prefetch" href="/vuepress/assets/js/45.7df9af65.js"><link rel="prefetch" href="/vuepress/assets/js/46.aa9bbf23.js"><link rel="prefetch" href="/vuepress/assets/js/47.f02e5c42.js"><link rel="prefetch" href="/vuepress/assets/js/48.13efb223.js"><link rel="prefetch" href="/vuepress/assets/js/49.02d68f1e.js"><link rel="prefetch" href="/vuepress/assets/js/5.05775f0d.js"><link rel="prefetch" href="/vuepress/assets/js/50.b7a1c4e6.js"><link rel="prefetch" href="/vuepress/assets/js/51.6e8fe59e.js"><link rel="prefetch" href="/vuepress/assets/js/52.3d80ae80.js"><link rel="prefetch" href="/vuepress/assets/js/53.71b8512d.js"><link rel="prefetch" href="/vuepress/assets/js/6.cdea11a5.js"><link rel="prefetch" href="/vuepress/assets/js/7.0be7f205.js"><link rel="prefetch" href="/vuepress/assets/js/8.5daa8986.js"><link rel="prefetch" href="/vuepress/assets/js/9.08e122ea.js">
    <link rel="stylesheet" href="/vuepress/assets/css/0.styles.7ff8f1d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div><div class="header-container"><div class="logo"><a href="/vuepress/" class="router-link-active"><span><img src="/vuepress/logo.png"></span> <h1>环信 IM 文档</h1></a></div> <div class="nav pc-nav"><div class="main-nav"><a href="/vuepress/product/introduction.html">产品简介</a><a href="/vuepress/document/Android/quickstart.html" class="active">集成文档</a><a href="/vuepress/api/Android">API 参考</a></div> <div class="nav-extra"><div class="search-container"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="secondary-nav"><a href="https://console.easemob.com/ticket" target="_blank">提交工单</a></div> <div class="switch-lang"><a href="javascript:;">选择语言<span class="triangle"></span></a> <div id="sub-menu" class="sub-menu menu-hidden"><ul><li class="active"><a href="/vuepress/document/Android/create_and_manage_chatroom.html" aria-current="page" class="router-link-exact-active router-link-active">简体中文</a></li><li><a href="/vuepress/en/document/Android/create_and_manage_chatroom.html">English</a></li></ul></div></div> <div class="login-register"><a href="https://console.easemob.com/user/login" target="_blank">登录</a><a href="https://console.easemob.com/user/register" target="_blank">注册</a></div></div></div> <div class="mobile-nav"><img src="/vuepress/icon-menu.png"></div></div> <!----> <!----></div> <div class="content-container"><div class="sider-container"><div class="platform"><div class="platform-input"><div class="platform-text"><img src="/vuepress/icon-Android-hover.svg" alt> <span>Android</span></div> <div class="select-icon"><i class="icon-arrow"></i></div></div> <div id="platform-list" class="platform-list menu-hidden"><!----><div class="group"><div class="group-title">平台</div> <div class="options"><div data-key="Android" class="option-item"><img src="/vuepress/icon-Android.svg" alt class="default"> <img src="/vuepress/icon-Android-hover.svg" alt class="active"> <span>Android</span></div><div data-key="iOS" class="option-item"><img src="/vuepress/icon-iOS.svg" alt class="default"> <img src="/vuepress/icon-iOS-hover.svg" alt class="active"> <span>iOS</span></div><div data-key="Web" class="option-item"><img src="/vuepress/icon-web.svg" alt class="default"> <img src="/vuepress/icon-web-hover.png" alt class="active"> <span>Web</span></div><div data-key="Windows" class="option-item"><img src="/vuepress/icon-windows.svg" alt class="default"> <img src="/vuepress/icon-windows-hover.svg" alt class="active"> <span>Windows</span></div></div></div><div class="group"><div class="group-title">框架</div> <div class="options"><div data-key="Mini-program" class="option-item"><img src="/vuepress/icon-mini-program.svg" alt class="default"> <img src="/vuepress/icon-mini-program-hover.svg" alt class="active"> <span>小程序</span></div><div data-key="Flutter" class="option-item"><img src="/vuepress/icon-flutter.svg" alt class="default"> <img src="/vuepress/icon-flutter-hover.png" alt class="active"> <span>Flutter</span></div><div data-key="React-Native" class="option-item"><img src="/vuepress/icon-ReactNative.svg" alt class="default"> <img src="/vuepress/icon-ReactNative-hover.svg" alt class="active"> <span>React Native</span></div></div></div><div class="group"><div class="group-title"></div> <div class="options"><div data-key="Server-side" class="option-item"><img src="/vuepress/icon-server-dark.png" alt class="default"> <img src="/vuepress/icon-server-light.png" alt class="active"> <span>服务端</span></div></div></div></div></div> <div class="sider-menu"><div class="item"><h2>快速开始</h2> <ul><li><a href="/vuepress/document/Android/demo.html">Demo（EaseIM App）</a></li><!----></ul></div><div class="item"><h2>基础功能</h2> <ul><li><a href="javascript:;">消息概述</a> <ul class="sider-menu-sub"><li><a href="/vuepress/document/Android/send_and_receive_message.html">发送和接收消息</a></li><li><a href="/vuepress/document/Android/manage_message.html">管理本地消息数据</a></li><li><a href="/vuepress/document/Android/message_retrieve.html">从服务器获取消息（消息漫游）</a></li><li><a href="/vuepress/document/Android/message_receipt.html">管理消息回执</a></li><li><a href="/vuepress/document/Android/message_translation.html">翻译</a></li></ul></li><li><a href="/vuepress/document/Android/userprofile.html">管理用户属性</a></li><li><a href="/vuepress/document/Android/user_relationship.html">管理用户关系</a></li><li><a href="javascript:;">群组概述</a> <ul class="sider-menu-sub"><li><a href="/vuepress/document/Android/create_and_manage_group.html">创建和管理群组</a></li><li><a href="/vuepress/document/Android/manage_group_member.html">管理群组成员</a></li><li><a href="/vuepress/document/Android/group_attributes.html">管理群组属性</a></li></ul></li><li><a href="javascript:;">聊天室概述<i class="icon-arrow"></i></a> <ul class="sider-menu-sub collapsable menu-hidden"><li class="active"><a href="/vuepress/document/Android/create_and_manage_chatroom.html" aria-current="page" class="router-link-exact-active router-link-active">创建和管理聊天室</a></li><li><a href="/vuepress/document/Android/manage_chatroom_member.html">管理聊天室成员</a></li><li><a href="/vuepress/document/Android/chatroom_attributes.html">管理聊天室属性</a></li></ul></li></ul></div><div class="item"><h2>进阶功能</h2> <ul><li><a href="/vuepress/document/Android/multi_device.html">登录多个设备</a></li><li><a href="/vuepress/document/Android/presence.html">管理在线状态订阅</a></li><li><a href="/vuepress/document/Android/reaction.html">消息表情回复</a></li><li><a href="javascript:;">管理子区</a> <ul class="sider-menu-sub"><li><a href="/vuepress/document/Android/message_thread.html">管理子区消息</a></li></ul></li><li><a href="/vuepress/document/Android/moderation.html">消息审核</a></li></ul></div><div class="item"><h2>其他</h2> <ul><li><a href="/vuepress/document/Android/error_code.html">错误码</a></li></ul></div></div></div> <div data-key="v-379c39ee" class="description-container"><div><div class="content__default"><h1 id="创建和管理聊天室以及监听器介绍"><a href="#创建和管理聊天室以及监听器介绍" class="header-anchor">#</a> 创建和管理聊天室以及监听器介绍</h1> <p>更新时间：2022-07-15</p> <p>聊天室是支持多人沟通的即时通讯系统。聊天室中的成员没有固定关系，用户离线后，超过 5 分钟会自动退出聊天室。聊天室成员在离线后，不会收到推送消息。聊天室可以应用于直播、消息广播等。</p> <p>本文介绍如何使用环信即时通讯 IM SDK 在实时互动 app 中创建和管理聊天室，并实现聊天室的相关功能。</p> <p>消息相关内容见 <a href="https://docs-im.easemob.com/ccim/android/message1" target="_blank" rel="noopener noreferrer">消息管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="技术原理"><a href="#技术原理" class="header-anchor">#</a> 技术原理</h2> <p>环信即时通讯 IM SDK 提供 <code>EMChatRoomManager</code> 类 和 <code>EMChatRoom</code> 类用于聊天室管理，支持你通过调用 API 在项目中实现如下功能：</p> <ul><li>创建聊天室</li> <li>从服务器获取聊天室列表</li> <li>加入聊天室</li> <li>获取聊天室详情</li> <li>退出聊天室</li> <li>解散聊天室</li> <li>监听聊天室事件</li></ul> <h2 id="前提条件"><a href="#前提条件" class="header-anchor">#</a> 前提条件</h2> <p>开始前，请确保满足以下条件：</p> <ul><li>完成 SDK 初始化，详见 <a href="https://docs-im.easemob.com/ccim/android/quickstart" target="_blank" rel="noopener noreferrer">快速开始<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li>了解环信即时通讯 IM 的 <a href="https://docs-im.easemob.com/ccim/limitation" target="_blank" rel="noopener noreferrer">使用限制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li>了解环信即时通讯 IM 不同版本的聊天室相关数量限制，详见 <a href="https://www.easemob.com/pricing/im" target="_blank" rel="noopener noreferrer">环信即时通讯 IM 价格<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li>只有超级管理员才有创建聊天室的权限，因此你还需要确保已调用 RESTful API 添加了超级管理员，详见 <a href="https://docs-im.easemob.com/ccim/rest/chatroom#%E6%B7%BB%E5%8A%A0%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98" target="_blank" rel="noopener noreferrer">添加聊天室超级管理员<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li>聊天室创建者和管理员的数量之和不能超过 100，即管理员最多可添加 99 个。</li></ul> <h2 id="实现方法"><a href="#实现方法" class="header-anchor">#</a> 实现方法</h2> <p>本节介绍如何使用环信即时通讯 IM SDK 提供的 API 实现上述功能。</p> <h3 id="创建聊天室"><a href="#创建聊天室" class="header-anchor">#</a> 创建聊天室</h3> <p>仅 <a href="https://docs-im.easemob.com/ccim/rest/chatroom#%E7%AE%A1%E7%90%86%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98" target="_blank" rel="noopener noreferrer">超级管理员<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以调用 <code>createChatRoom</code> 方法创建聊天室，并设置聊天室的名称、描述、最大成员数等信息。成功创建聊天室后，该超级管理员为该聊天室的所有者。</p> <p>你也可以直接调用 REST API <a href="https://docs-im.easemob.com/ccim/rest/chatroom#%E5%88%9B%E5%BB%BA%E8%81%8A%E5%A4%A9%E5%AE%A4" target="_blank" rel="noopener noreferrer">从服务端创建聊天室<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>示例代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 异步方法</span>
<span class="token class-name">EMChatRoom</span>  chatRoom <span class="token operator">=</span> <span class="token class-name">EMClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chatroomManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createChatRoom</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> description<span class="token punctuation">,</span> welcomMessage<span class="token punctuation">,</span> maxUserCount<span class="token punctuation">,</span> members<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="加入聊天室"><a href="#加入聊天室" class="header-anchor">#</a> 加入聊天室</h3> <p>用户申请加入聊天室的步骤如下：</p> <ol><li><p>调用 <code>fetchPublicChatRoomsFromServer</code> 方法从服务器获取聊天室列表，查询到想要加入的聊天室 ID。</p></li> <li><p>调用 <code>joinChatRoom</code> 方法传入聊天室 ID，申请加入对应聊天室。新成员加入聊天室时，其他成员收到 <code>onMemberJoined</code> 回调。</p></li></ol> <p>示例代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 获取公开聊天室列表，每次最多可获取 1,000 个。</span>
<span class="token class-name">EMPageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EMChatRoom</span><span class="token punctuation">&gt;</span></span> chatRooms <span class="token operator">=</span> <span class="token class-name">EMClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chatroomManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                            <span class="token function">fetchPublicChatRoomsFromServer</span><span class="token punctuation">(</span>pageNumber<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加入聊天室</span>
<span class="token class-name">EMClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chatroomManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">joinChatRoom</span><span class="token punctuation">(</span>chatRoomId<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">EMValueCallBack</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EMChatRoom</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">EMChatRoom</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token keyword">int</span> error<span class="token punctuation">,</span> <span class="token class-name">String</span> errorMsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="获取聊天室详情"><a href="#获取聊天室详情" class="header-anchor">#</a> 获取聊天室详情</h3> <p>聊天室所有成员均可调用 <code>fetchChatRoomFromServer</code> 获取聊天室的详情，包括聊天室 ID、聊天室名称，聊天室描述、聊天室公告、管理员列表、最大成员数、聊天室所有者、是否全员禁言以及聊天室角色类型。成员列表、黑名单列表、禁言列表需单独调用接口获取。</p> <p>示例代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 异步方法</span>
<span class="token class-name">EMChatRoom</span> chatRoom <span class="token operator">=</span> <span class="token class-name">EMClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chatroomManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fetchChatRoomFromServer</span><span class="token punctuation">(</span>chatRoomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="退出聊天室"><a href="#退出聊天室" class="header-anchor">#</a> 退出聊天室</h3> <p>聊天室所有成员均可以调用 <code>leaveChatRoom</code> 方法退出当前聊天室。成员退出聊天室时，其他成员收到 <code>onMemberExited</code> 回调。</p> <p>示例代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">EMClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chatroomManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leaveChatRoom</span><span class="token punctuation">(</span>chatRoomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>退出聊天室时，SDK 默认删除该聊天室所有本地消息，若要保留这些消息，可在 SDK 初始化时将 <code>EMOptions#setDeleteMessagesAsExitChatRoom</code> 设置为 <code>false</code>。</p> <p>示例代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">EMOptions</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EMOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
options<span class="token punctuation">.</span><span class="token function">setDeleteMessagesAsExitChatRoom</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>与群主无法退出群组不同，聊天室所有者可以离开聊天室，例如所有者从服务器下线则 5 分钟后自动离开聊天室。如果所有者重新进入聊天室仍是该聊天室的所有者。</p> <h3 id="解散聊天室"><a href="#解散聊天室" class="header-anchor">#</a> 解散聊天室</h3> <p>仅聊天室所有者可以调用 <code>destroyChatRoom</code> 方法解散聊天室。聊天室解散时，其他成员收到 <code>onChatRoomDestroyed</code> 回调并被踢出聊天室。</p> <p>示例代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 异步方法。</span>
<span class="token class-name">EMClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chatroomManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">destroyChatRoom</span><span class="token punctuation">(</span>chatRoomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="监听聊天室事件"><a href="#监听聊天室事件" class="header-anchor">#</a> 监听聊天室事件</h3> <p><code>EMChatRoomChangeListener</code> 类中提供了聊天室事件的监听接口。你可以通过注册聊天室监听器，获取聊天室事件，并作出相应处理。如不再使用该监听器，需要移除，防止出现内存泄露。</p> <p>示例代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 注册聊天室回调</span>
<span class="token class-name">EMClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chatroomManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addChatRoomChangeListener</span><span class="token punctuation">(</span>chatRoomChangeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 移除聊天室回调</span>
<span class="token class-name">EMClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chatroomManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeChatRoomListener</span><span class="token punctuation">(</span>chatRoomChangeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>具体事件如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EMChatRoomChangeListener</span> <span class="token punctuation">{</span>
    <span class="token comment">// 聊天室被解散</span>
    <span class="token keyword">void</span> <span class="token function">onChatRoomDestroyed</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> roomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> roomName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 有用户加入聊天室</span>
    <span class="token keyword">void</span> <span class="token function">onMemberJoined</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> roomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> participant<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 有成员离开聊天室</span>
    <span class="token keyword">void</span> <span class="token function">onMemberExited</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> roomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> roomName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> participant<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 有成员被移出聊天室
     *
     * @param reason        用户被移出聊天室的原因：
     *                        - xxx BE_KICKED：该用户被聊天室管理员移出；
     *                        - xxxBE_LICKED)FOR_OFFLINE：该用户由于当前设备断网被服务器移出聊天室。
     */</span>
    <span class="token keyword">void</span> <span class="token function">onRemovedFromChatRoom</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">int</span> reason<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> roomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> roomName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> participant<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 有成员被加入禁言列表</span>
    <span class="token keyword">void</span> <span class="token function">onMuteListAdded</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> chatRoomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mutes<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">long</span> expireTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 有成员被移出禁言列表</span>
    <span class="token keyword">void</span> <span class="token function">onMuteListRemoved</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> chatRoomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mutes<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 有成员被加入白名单列表</span>
    <span class="token keyword">void</span> <span class="token function">onWhiteListAdded</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> chatRoomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> whitelist<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 有成员被移出白名单列表</span>
    <span class="token keyword">void</span> <span class="token function">onWhiteListRemoved</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> chatRoomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> whitelist<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 全员禁言状态变更</span>
    <span class="token keyword">void</span> <span class="token function">onAllMemberMuteStateChanged</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> chatRoomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> isMuted<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 有成员被设为管理员</span>
    <span class="token keyword">void</span> <span class="token function">onAdminAdded</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> chatRoomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 有成员被移除管理员权限</span>
    <span class="token keyword">void</span> <span class="token function">onAdminRemoved</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> chatRoomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 聊天室所有者变更</span>
    <span class="token keyword">void</span> <span class="token function">onOwnerChanged</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> chatRoomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> newOwner<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> oldOwner<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// 聊天室公告变更</span>
    <span class="token keyword">void</span> <span class="token function">onAnnouncementChanged</span><span class="token punctuation">(</span><span class="token class-name">String</span> chatRoomId<span class="token punctuation">,</span> <span class="token class-name">String</span> announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="更多操作"><a href="#更多操作" class="header-anchor">#</a> 更多操作</h3> <p>你可以参考如下文档，在项目中实现更多的聊天室相关功能：</p> <ul><li><a href="https://docs-im.easemob.com/ccim/android/chatroom1" target="_blank" rel="noopener noreferrer">聊天室概述<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs-im.easemob.com/ccim/android/chatroom3" target="_blank" rel="noopener noreferrer">管理聊天室成员<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs-im.easemob.com/ccim/android/chatroom4" target="_blank" rel="noopener noreferrer">管理聊天室属性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <div class="back-to-top hidden"></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/maniacflow/vuepress/edit/master/docs/document/Android/create_and_manage_chatroom.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated">更新时间：2022/7/26 下午2:41:35</div></div></div></div> <link id="code-theme" rel="stylesheet"></div><div class="global-ui"></div></div>
    <script src="/vuepress/assets/js/app.b5d11d4d.js" defer></script><script src="/vuepress/assets/js/3.6e2d5973.js" defer></script><script src="/vuepress/assets/js/1.7ac2d96d.js" defer></script><script src="/vuepress/assets/js/15.dce43bf0.js" defer></script>
  </body>
</html>
